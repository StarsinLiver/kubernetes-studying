<!-- 인그레스를 이용한 인입 트래픽 관리 -->
# 서비스는 외부에서 들어오는 트래픽을 쿠버네티스안으로 인도하는 역할을 한다.
# 지금까지 우리는 우베 애플리케이션에 외부 사용자가 접근할 수 있도록 여러 개의 로드밸런서 서비스를 사용했다.
# 이 방법은 애플리케이션마다 IP주소를 따로 부여하고 부여된 주소와 애플리케이션 관계를 DNS 서버에서 제공해야 하기 때문에 관리적인 문제가 발생하기 쉽다.
# 인입되는 트래픽을 올바른 애플리케이션으로 연결하는 일은 라우팅과 관련된 문제이지만, 인그레스(Ingress)를 사용하면 이를 쿠버네티스 안에서도 다룰 수 있다.

<!-- 인그레스(ingress) -->
# 도메인 네임을 이용한 라우팅과 관련된 문제는 리버스 프록시(reverse proxy)로 거의 해결할 수 있는데, 쿠버네티스의 인그레스는 플러그인이 가능한 아키텍처가 적용되었다.
# 따라서 라우팅 규칙을 일반적인 쿠버네티스 리소스로 정의하고 리버스 프록시로 사용할 컴포넌트에 이 규칙에 따라 트래픽을 처리하도록 하는 구조다.
# 비교적 최근 출시되어 컨테이너와 연동 가능한 것들을 포함해서 모든 주요 리버스 프록시는 쿠버네티스를 지원한다.
# 이들 리버스 프록시는 기능과 동작 모델이 제각각이다.
# 이 장에서는 인그레스를 사용하여 클러스터에서 두 개 이상의 애플리케이션을 호스팅하는 방법과 함께 대표적인 리버스 프록시인 Nginx와 Trafik을 다룬다.

<!-- 인그레스의 라우팅 과정 -->
# 인그레스는 리버스 프록시를 인그레스 컨트롤러(ingress controller)로 사용하여 리버스 프록시에 좀 더 주도적인 역할을 맡긴다.
# 하지만 전체적인 구도는 크게 다르지 않다. 리버스 프록시는 로드밸런서 서비스에서 외부 트래픽을 받아들이고, 클러스터 IP서비스 형태로 된 애플리케이션에서 요청한 콘텐츠를 받아 와 제공하는 구도는 그대로다.

# 인그레스 서비스는 외부로 노출되는 유일한 서비스다. 클라우드의 로드밸런서나 데이터센터의 노드포트(NodePort)와 같은 역할을 한다.

# 인그레스 컨트롤러는 리버스 프록시의 일종이다. 외부에서 들어오는 모든 요청을 받아들이고 이에 따라 적절한 애플리케이션에서 콘텐츠를 가져오는 역할을 한다.

# 핵심은 인그레스 컨트롤러다. 이 컨트롤러는 쉽게 교체할 수 있는 리버스 프록시라고 볼 수 있다.
# HAProxy, Nginx, 컨투어 , 트래픽 등 다양한 선택지가 있다.
# 인그레스 객체에는 라우팅 규칙이 일반적인 형태로 기술되어 있고, 이 규칙을 프록시에 적용한다.
# 프록시마다 기능에 차이가 있으므로 인그레스 정의에는 공통적인 내용만 담기며, 애너테이션으로 특정 프록시만 지원하는 기능을 추가하낟.

<!-- 인그레스 객체 배치해보자 -->
# 애플리케이션과 인그레스 컨트롤러가 준비되었으니 인그레스 컨트롤러에 라우팅 규칙을 전달할 인그레스 객체를 배치할 차례다.
# 모든 요청을 Hello World 애플리케이션으로 전달하도록 했다.

# 인그레스 컨트롤러는 인그레스 객체의 추가나 변경을 감시한다.
# 따라서 인그레스 객체를 새로 배치하면 객체에 담긴 라우팅 규칙이 Nginx 설정에 추가된다. Nginx 관점에서 보면 hello-kiamol 서비스를 업스트림(콘텐츠를 받아 올 곳)으로 삼는 프록시 서버가 설정되는 것과 같은 결과를 낳는다.
# 그리고 루트 경로에 대한 요청에 hello-kiamol의 콘텐츠를 제공한다.

<!-- local.yaml -->
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: hello-kiamol
  labels:
    kiamol: ch15
spec:
  rules:
  - http:                         # 인그레스는 HTTP/HTTPS 트래픽만 다룬다.
      paths:
      - path: /                   # 모든 요청을
        pathType: Prefix
        backend:                  # hello-kiamol 서비스로 전달한다.
          service:
            name: hello-kiamol
            port:
              number: 80        
