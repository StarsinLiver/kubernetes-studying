<!-- 롤링 업데이트 정의에서의 레플리카셋의 파드 스케일링 속도 조절 -->
# 롤링 업데이트가 기본값인 이유는 이 전략이 서비스 중단 시간을 최소화해주기 때문이다.
# 그렇다 하더라도 꽤나 적극적인 전략인 것은 사실이다. 릴리스 대상이 운영 환경이라면 릴리스 속도나 모니터링 방식 등 몇 가지 설정을 손보고 싶을 때가 있다.
# 롤링 업데이트 정의에서 기존 및 신규 레플리카셋의 파드 스케일링 속도를 다음 두 값으로 조절할 수 있다.

1) maxUnavailable : 
이 값은 기존 레플리카셋의 스케일링 속도를 조절하는 값이다. 정확하게 설명하면 업데이트 동안 사용할 수 없는 파드의 최대 개수다. 기존 레플리카셋에서 동시에 종료되는 파드 수라고 생각하면 된다. 파드 수가 열 개인 디플로이먼트에서 30%를 설정하면 바로 종료되는 파드 수는 세 개가 된다.

2) maxSurge : 
이 값은 레플리카셋의 스케일링 속도를 조절하는 값이다. 정확하게는 업데이트 동안 잉여 파드의 최대 개수다.
새 레플리카셋에서 동시에 함께 시작되는 파드 수라고 생각하면 된다. 파드 수가 열 개인 디플로이먼트에서 40%를 설정하면 한번에 파드 네 개를 생성한다.

<!-- 롤링 업데이트 정의에서의 롤아웃 속도를 조절 -->
# 애플리케이션이 간단해서 파드 실행 속도가 빠르므로 조금 전 실습에서 롤아웃 과정을 관찰할 수 있으려면 명령을 빠르게 입력해야 한다. 디플로이먼트 정의에서 다음 두 값을 사용하여 롤아웃 속도를 조절할 수 있다.

1) minReadySeconds : 
신규 파드의 상태가 안정적인지 확인할 수 있는 시간 여유를 둔다. 지정된 값의 시간 동안(단위 : 초) 오류로 종료되는 컨테이너가 없어야 파드 상태를 안정적으로 판정한다. 이 값의 기본값이 0이었기 때문에 롤아웃 진행 속도가 빨랐다.

2) progressDeadlineSeconds : 
시간을 초과할 때는 신규 파드의 상태를 실패로 간주하는 타임아웃 시간을 가리킨다.
기본값은 600이므로 10분안에 파드 상태가 안정되지 않는다면 해당 파드의 상태를 실패로 간주한다.


<!-- 롤링 업데이트 -->
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vweb
  labels:
    kiamol: ch09
spec:
  replicas: 3
  selector:
    matchLabels:
      app: vweb
  strategy:
    type: RollingUpdate         # default 값
    rollingUpdate:              
      maxUnavailable: 0         # 업데이트 동안 사용할 수 없는 파드의 최대 개수 default : 0
      maxSurge: 1               # 업데이트 동안 잉여 파드의 최대 개수           default : 0
  template:
    metadata:
      labels:
        app: vweb
        version: v2
    spec:
      containers:
        - name: web
          image: kiamol/ch09-vweb:v2
          ports:
            - name: http
              containerPort: 80

